/* Claro Graphics - an abstraction layer for native UI libraries
 *
 * $Id$
 *
 * The contents of this file are subject to the Mozilla Public License
 * Version 1.1 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
 * License for the specific language governing rights and limitations
 * under the License.
 *
 * See the LICENSE file for more details.
 */


#ifndef _CLARO_BASE_HASHTABLE_H
#define _CLARO_BASE_HASHTABLE_H

struct hashtable_;

typedef struct hashtable_ hashtable_t;

/*****************************************************************************
 * create_hashtable
   
 * @name                    hashtable_str_create
 * @param   minsize         minimum initial size of hashtable
 * @param   copy_strings    whether to copy all string keys, or to use static strings
 * @param   val_free_fn       function for freeing values
 * @return                  newly created hashtable or NULL on failure
 */
 
CLFEXP hashtable_t *
hashtable_str_create(unsigned int minsize, int copy_strings, void    (*val_free_fn) (void*));

/*****************************************************************************
 * create_hashtable
   
 * @name                    create_hashtable
 * @param   minsize         minimum initial size of hashtable
 * @param   hashfunction    function for hashing keys
 * @param   key_eq_fn       function for determining key equality
 * @return                  newly created hashtable or NULL on failure
 */

CLFEXP hashtable_t *
hashtable_create(unsigned int minsize,
                 unsigned int (*hashfunction) (void*),
                 int (*key_eq_fn) (void*,void*),
				 void (*key_free_fn) (void*),
				 void	 (*val_free_fn) (void*)	);

/*****************************************************************************
 * hashtable_insert
   
 * @name        hashtable_insert
 * @param   h   the hashtable to insert into
 * @param   k   the key - hashtable claims ownership and will free on removal
 * @param   v   the value - does not claim ownership
 * @param   replace replace the key with a new value? 
 * @return      non-zero for successful insertion
 *
 * This function will cause the table to expand if the insertion would take
 * the ratio of entries to table size over the maximum load factor.
 *
 * This function does not check for repeated insertions with a duplicate key.
 * The value returned when using a duplicate key is undefined -- when
 * the hashtable changes size, the order of retrieval of duplicate key
 * entries is reversed.
 * If in doubt, remove before insert.
 */

CLFEXP int 
hashtable_insert(hashtable_t *h, void *k, void *v, int replace);


/*****************************************************************************
 * hashtable_search
   
 * @name        hashtable_search
 * @param   h   the hashtable to search
 * @param   k   the key to search for  - does not claim ownership
 * @return      the value associated with the key, or NULL if none found
 */

CLFEXP void *
hashtable_search(hashtable_t *h, void *k);

/*****************************************************************************
 * hashtable_remove
   
 * @name        hashtable_remove
 * @param   h   the hashtable to remove the item from
 * @param   k   the key to search for  - does not claim ownership
 * @return      the value associated with the key, or NULL if none found
 */

CLFEXP void * /* returns value */
hashtable_remove(hashtable_t *h, void *k);

/*****************************************************************************
 * hashtable_count
   
 * @name        hashtable_count
 * @param   h   the hashtable
 * @return      the number of items stored in the hashtable
 */
CLFEXP unsigned int
hashtable_count(hashtable_t *h);


/*****************************************************************************
 * hashtable_destroy
   
 * @name        hashtable_destroy
 * @param   h   the hashtable
 * @param       free_values     whether to call 'free' on the remaining values
 */

CLFEXP void
hashtable_destroy(hashtable_t *h);

#endif

